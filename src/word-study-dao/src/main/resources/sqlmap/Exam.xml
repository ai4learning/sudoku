<?xml version="1.0" encoding="UTF-8" ?> 
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd"> 
<mapper namespace="com.goldfish.dao.ExamDao">

  <resultMap id="Exam-Map" type="com.goldfish.domain.Exam">
 		<id property="id" column="id"/>
		<result property="userId" column="user_id"/>
		<result property="userCode" column="user_code"/>
		<result property="lessonId" column="lesson_id"/>
	  	<result property="moduleCode" column="module_code"/>
		<result property="unitNbr" column="unit_nbr"/>
		<result property="pageId" column="page_id"/>
		<result property="testType" column="test_type"/>
		<result property="resultScore" column="result_score"/>
		<result property="standardDuration" column="standard_duration"/>
		<result property="realDuration" column="real_duration"/>
		<result property="errorNbr" column="error_nbr"/>
		<result property="cashPoint" column="cash_point"/>
		<result property="cashPointType" column="cash_point_type"/>
		<result property="isPass" column="is_pass"/>
		<result property="state" column="state"/>
		<result property="created" column="created"/>
		<result property="modified" column="modified"/>

	</resultMap>


    <!-- 字段和bean里面一致，否则报错-->
	<sql id="BEAN-COMMON-SQL">
    	 
    		<where>
    		<if test="id != null"> AND id = #{id}</if>
    		<if test="userId != null"> AND user_id = #{userId}</if>
    		<if test="lessonId != null"> AND lesson_id = #{lessonId}</if>
    		<if test="moduleCode != null"> AND module_code = #{moduleCode}</if>
    		<if test="pageId != null"> AND page_id = #{pageId}</if>
    		<if test="testType != null"> AND test_type = #{testType}</if>
    		<if test="cashPointType != null"> AND cash_point_type = #{cashPointType}</if>
    		<if test="state != null"> AND state = #{state}</if>
    		
    		</where>
    	 
    	</sql>


	<!-- 可以包含bean里面没有的字段-->
	<sql id="MAP-COMMON-SQL">
	   
		<where>
		<if test="id != null"> AND id = #{id}</if>
		<if test="userId != null"> AND user_id = #{userId}</if>
		<if test="lessonId != null"> AND lesson_id = #{lessonId}</if>
		<if test="moduleCode != null"> AND module_code = #{moduleCode}</if>
		<if test="pageId != null"> AND page_id = #{pageId}</if>
		<if test="testType != null"> AND test_type = #{testType}</if>
		<if test="cashPointType != null"> AND cash_point_type = #{cashPointType}</if>
		<if test="state != null"> AND state = #{state}</if>
		
		</where>
	 	
	</sql>
	
	<sql id="ORDER-SQL">
	 order by id desc
	</sql>
	

	<sql id="All-FIELDS">
		id,user_id,user_code,lesson_id,module_code,unit_nbr,page_id,test_type,result_score,standard_duration,real_duration,error_nbr,cash_point,cash_point_type,is_pass,state,created,modified
	</sql>

	<insert id="addExam" parameterType="com.goldfish.domain.Exam">
		insert into exam (user_id,user_code,lesson_id,module_code,unit_nbr,page_id,test_type,result_score,standard_duration,real_duration,error_nbr,cash_point,cash_point_type,is_pass,state,created,modified)
			values(#{userId},#{userCode},#{lessonId},#{moduleCode},#{unitNbr},#{pageId},#{testType},#{resultScore},#{standardDuration},#{realDuration},#{errorNbr},#{cashPoint},#{cashPointType},#{isPass},#{state},#{created},#{modified})
    
		<selectKey resultType="java.lang.Long" keyProperty="id" order="AFTER">
		   select last_insert_id() as ID from dual
		</selectKey> 
   
	 </insert>

    
    <update id="updateExam" parameterType="com.goldfish.domain.Exam" >
    	update  exam 
	<set>
			<if test="userId !=null"> user_id = #{userId},</if>
			<if test="userCode !=null"> user_code = #{userCode},</if>
			<if test="lessonId !=null"> lesson_id = #{lessonId},</if>
			<if test="moduleCode != null"> module_code = #{moduleCode},</if>
			<if test="unitNbr !=null"> unit_nbr = #{unitNbr},</if>
			<if test="pageId !=null"> page_id = #{pageId},</if>
			<if test="testType !=null"> test_type = #{testType},</if>
			<if test="resultScore !=null"> result_score = #{resultScore},</if>
			<if test="standardDuration !=null"> standard_duration = #{standardDuration},</if>
			<if test="realDuration !=null"> real_duration = #{realDuration},</if>
			<if test="errorNbr !=null"> error_nbr = #{errorNbr},</if>
			<if test="cashPoint !=null"> cash_point = #{cashPoint},</if>
			<if test="cashPointType !=null"> cash_point_type = #{cashPointType},</if>
			<if test="isPass !=null"> is_pass = #{isPass},</if>
			<if test="state !=null"> state = #{state},</if>
			<if test="created !=null"> created = #{created},</if>
			<if test="modified !=null"> modified = #{modified},</if>

	</set>
	 where id = #{id}
  	</update>
  
	

    

	<delete id="deleteExam" parameterType="com.goldfish.domain.Exam">
		DELETE FROM exam WHERE id = #{id}
	</delete>
	<select id="getExamById" resultMap="Exam-Map" parameterType="java.lang.Long">
		SELECT  <include refid="All-FIELDS"/> FROM exam	WHERE id = #{id}
	</select>  
    



	<select id="getUnique" resultMap="Exam-Map" parameterType="com.goldfish.domain.Exam">
		SELECT   <include refid="All-FIELDS"/> FROM exam
            <include refid="BEAN-COMMON-SQL" /> limit 1
	</select>


	<select id="getListByExample" resultMap="Exam-Map" parameterType="com.goldfish.domain.Exam">
		SELECT   <include refid="All-FIELDS"/> FROM exam
            <include refid="BEAN-COMMON-SQL" />
	</select>

	
	<select id="getExamByPage" resultMap="Exam-Map" parameterType="java.util.HashMap">
		<![CDATA[
			SELECT  id,user_id,user_code,lesson_id,module_code,unit_nbr,page_id,test_type,result_score,standard_duration,real_duration,error_nbr,cash_point,cash_point_type,is_pass,state,modified FROM exam
		]]>
            <include refid="MAP-COMMON-SQL" />
            <include refid="ORDER-SQL" />
		LIMIT #{startIndex},#{pageSize}
	</select>
	
	<select id="count" resultType="java.lang.Integer" parameterType="java.util.HashMap">
		<![CDATA[
			SELECT COUNT(1) FROM exam
		]]>
		
              <include refid="MAP-COMMON-SQL" />
	</select>

	<select id="getListByUserRecent" resultMap="Exam-Map" parameterType="java.util.HashMap">
		SELECT   <include refid="All-FIELDS"/> FROM exam
		<include refid="BEAN-COMMON-SQL" /> AND <![CDATA[ TO_DAYS(NOW())-TO_DAYS(created) <= #{limit}     ]]>   ORDER BY created DESC
	</select>

</mapper>